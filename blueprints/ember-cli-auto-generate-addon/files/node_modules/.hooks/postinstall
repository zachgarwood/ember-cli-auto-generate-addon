#!/usr/bin/env node
if (process.env.npm_package_name === 'ember-cli-auto-generate-addon') process.exit();

const fs = require('fs');
const path = require('path');
const { spawn } = require('child_process');

let currentPackage = require(path.join(process.cwd(), 'package.json'));
let isEmberAddon = currentPackage.keywords && currentPackage.keywords.includes('ember-addon');
if (!isEmberAddon) process.exit();

let blueprint =
  process.env.npm_package_ember_addon_defaultBlueprint ?
  process.env.npm_package_ember_addon_defaultBlueprint :
  process.env.npm_package_name;
let blueprintExists = fs.existsSync(path.join(process.cwd(), 'blueprints', blueprint));
if (!blueprintExists) process.exit();

process.chdir(process.env.INIT_CWD);
spawn('ember', ['generate', blueprint], { stdio: 'inherit' });
